const data = [["fall back on","に頼る、を当てにする"],["hold off","すぐにしない（で待つ）"],["rule out","を排除[除外]する"],["fall for","にだまされる、引っかかる"],["miss out","逃す、経験し損なう、を抜かす"],["come down with","（軽い病気に）かかる"],["shake up","を改革[再編]する、を動揺させる"],["hold out","持ちこたえる、頑張る"],["let up","気を緩める、手を抜く、和らぐ"],["call for","を必要とする、を要求する"],["come into","を相続する、（ある状態に）になる"],["dispose of","を処分する、処理する、解決する"],["chip in","金を出し合う"],["stick with","を変えない、にこだわる"],["go for","を手に入れようとする、が欲しい"],["make off with","を持ち去る、盗む、を誘拐する"],["cover for","の代わりを務める"],["bring on","を引き起こす"],["stick around","居残る、その場でしばらく待つ"],["fall on","（責任などが）に降りかかる、課せられる"],["catch on","理解し始める"],["set off","出発する、を引き起こす"],["win over","を説得して味方につける、説き伏せる"],["fall through","失敗に終わる"],["track down","を追跡して捕まえる、追い詰める"],["sell out","信念を曲げる、裏切る、を売り尽くす"],["drag on","長引く、だらだら続く"],["die down","弱まる"],["break down","屈する、故障する、分解される"],["make up","仲直りする、を構成する、占める"],["call off","を中止する、とりやめる"],["live up to","に沿う"],["bring up","を持ち出す、提起する、を育てる"],["sum up","を要約する、かいつまんで話す"],["split up","別れる、分割される"],["stick up for","を支持する、擁護する"],["step down","辞職する、降りる"],["give out","動かなくなる、故障する、を配る"],["burn out","燃え尽きる、を燃やし尽くす"],["rough up","に暴力をふるう"],["draw on","を生かす"],["back off","口出しをやめる、後退する"],["hold back","ためらう、を抑える"],["knock down","を取り壊す、解体する、を倒す"],["round up","を駆り集める、を検挙する"],["see through","を見抜く、を透かして見る"],["map out","を立てる、を綿密に計画する"],["bring out","を引き出す、を持ち出す、を新しく出す"],["feel for","に同情する、を気の毒に思う"],["pile in","どやどやと中に入る"],["wrap up","を終える、やり遂げる"],["pass off","をつかませる"],["take in","を見物する、をだます、を摂取する"],["leave off","やめる、中断する"],["jump at","に飛びつく"],["kick off","を始める、始まる"],["grow out of","成長して（癖・興味）がなくなる、から発展して生じる"],["dish out","を（よく考えずに）配る、与える"],["cut back on","を削減する、減らす"],["make up for","を補う、つぐなう"],["go over","を復習する、見直す、を検討する"],["give away","をもらす、暴露する、を（～に）ただでやる"],["keep up","遅れずについていく、をやり続ける"],["come along","はかどる、進展する、一緒に来る、現れる"],["add up to","結局～ということになる、合計～になる"],["point to","を示す、表す、を指摘する"],["settle down","落ち着く、収まる"],["dry up","尽きる、枯渇する、干上がる"],["straighten out","を収拾する、解決する"],["set aside","を取っておく、を別にしておく"],["turn in","寝る、を提出する"],["hang onto","を持ち続ける、に執着する"],["tear down","を取り壊す"],["shape up","きちんと振る舞う、頑張る"],["set out to do","～し始める、することに着手する"],["cover up","を隠す、身を包む、服を着る"],["turn away","を中に入れない、を追い払う、の目を背けさせる"],["put in","を備えつける、を費やす"],["get into","に興味をもつ、はまる、の中に入る、に巻き込まれる"],["act on","に基づいて行動する"],["kick back","リラックスする、休憩する"],["stem from","に由来する"],["stir up","を引き起こす、をかき立てる"],["push for","を強く求める"],["carry away","夢中になる、興奮する、を運び去る"],["throw up","吐く、嘔吐する"],["set down","書き留める"],["endear A to B","AをBに好かれるようにする"],["pull over","車を端に寄せて止める"],["live on","で暮らしを立てる、を常食とする"],["drag out","をだらだらと長引かせる、を引きずり出す"],["come down to","に帰着する、集約される"],["blow up","かんしゃくを爆発させる、爆発する"],["pass up","を逃す、見送る"],["see about doing","～する手配をする"],["branch out","拡大する、手を広げる"],["wind up","～することになる、最後には～に至る"],["relate to","に共感する、の気持ちがわかる、に関連している"],["tighten up","を強化する、厳しくする"],["spring up","急に現れる、次々に誕生する"],["contend with","に取り組む、に対処する"],["tune in","ダイヤル[チャンネル]を合わせる"],["measure up to","に達する"],["check up on","～の行動を調べる、様子を見る"],["turn around","好転する、上向く、向きを変える"],["want for","（必要なもの）がない、～を欠いている"],["go astray","行方不明になる、盗まれる"],["cross out","を消す、リストから外す"],["mess with","をいじくる、に手を出す"],["speak for","～の意見を代弁する"],["head off to","～に進む、向かう"],["buy out","～の事業を買い取る"],["spell out","をはっきりと説明する"],["break away from","を抜け出す、～とたもとを分かつ"],["pull in","駅に着く、バス停に着く"],["talk A into doing","～するようにAを説得する"],["count for","～の価値がある"],["wrestle with","～に取り組む"],["kick around","～についてあれこれ検討する"],["happen on","を偶然見つける、～に出くわす"],["give over","を任せる、委ねる"],["bounce back","立ち直る、回復する"],["stop up","を詰まらせる、ふさぐ"],["bet on","に賭ける"],["get around","歩き回る、出歩く"],["fall off","減少する、低下する"],["round out","～を（いい形で）締めくくる"],["pay off","実を結ぶ"],["go by","通り過ぎる、（時間が）過ぎる"],["bear with","（人）に我慢して付き合う"],["go along with","～に同意する、賛同する"],["touch on","～に触れる、言及する"],["come before","～に出る"],["phase out","を段階的に停止する"],["tune up","を整備する、を調律する"],["head out","出発する"],["come off","思える、外れる、うまくいく"],["put forth","示す、提案する、（努力）をする"],["branch off","枝分かれする、脇道にそれる"],["hang around","ぶらつく、たむろする"],["narrow down","（範囲など）を絞る、狭める"],["spring from","～から生じる、～に起因する"],["fill in for","～の代理を務める"],["adhere to","を忠実に守る、を信奉する"],["settle for","～に甘んじる、～でよしとする"],["catch up on","を知る、～の遅れを取り戻す"],["get down to","～に取り掛かる"],["put forward","を出す、提案する"],["lay down","を設定する、定める、を捨てる"],["set in","始まる、到来する"],["fall away","弱まる、なくなる"],["sit by","傍観する、手をこまねいている"],["eat up","を食い尽くす、を食べ尽くす"],["burn off","を燃やす、消費する"],["cling to","～にしがみつく"],["pull off","を苦労して成し遂げる、～からそれる"],["go at","～に取り組む"],["get at","をほのめかす、～に近づく"],["come through","提供する、期待に応える、を切り抜ける"],["turn out","出かける、判明する"],["be drawn into","～に巻き込まれる"],["blow out","解消される、収まる"],["shove aside","を脇に押しやる、無視する"],["attend to","～の相手をする、を扱う"],["back down","引き下がる、後退する、取り消す"],["pull through","健康を回復する"],["stand down","職[地位]から身を引く"],["give off","を発する、出す"],["play up","を強調する、誇張する"],["do away with","を廃止する、を始末する"],["take on","を採用する、を引き受ける、を帯びる"],["hand off","を手渡す、引き渡す"],["bank on","を当てにする、～に頼る"],["make out","を何とか理解する、を作成する"],["call on","を訪問する"],["sink in","十分理解される、染み込む"],["brush off","を拒絶する、はねつける"],["get away with","をして無事に逃れる、を持ち逃げする"],["back up","を支持する、後退する、バックアップをとる"],["draw up","を作成する、（車が）止まる"],["roll up","（そで、裾など）をまくる"],["run through","をざっと調べる、目を通す、～のリハーサルをする"],["build up","を発達させる、増やす"],["turn down","を小さくする、弱める"],["let down","を失望させる、～の期待を裏切る"],["count on","を当てにする、～に頼る"],["get by","何とか生活する、間に合わせる"],["lay off","を解雇する"],["opt for","を選択する"],["wear off","薄れる、次第に消える"],["wash away","を押し流す、洗い流す"],["give in","屈する、折れる、を提出する、渡す"],["make over","を作り変える、作り直す、を譲り渡す"],["sign out","を署名して借り出す"],["wave off","を拒む、逃げる"],["try out","をテストする"],["stumble on","～に偶然出くわす"],["talk up","を実際よりよいように説明する"],["scoop up","をすくい取る、すくい上げる"],["go through with","を遂行する"],["pick over","を丹念に選ぶ"],["scale down","を縮小する"],["lift off","離陸する、打ち上げられる"],["hold down","を押さえつける、を抑える、を続ける"],["clean out","～の中をきれいにする、を空にする"],["air out","を換気する、を外気に当てる、干す"],["look out for","～に気を付ける、注意する"],["grow into","成長して～になる、成長して（服）が着られるようになる"],["close in","近づいてくる、追ってくる、悪くなる"],["step up","を強化する、上がる、上る"],["cut in","口をはさむ、割って入る"],["look down on","を見下す、さげすむ"],["pass out","気絶する、意識を失う、を配る"],["slip on","をざっと着る、をざっと履く"],["play out","展開する"],["pull back","手を引く、撤退する、を後退させる"],["skim over","～にざっと目を通す"],["tell on","を言いつける、告げ口する"],["smooth over","を丸く収める"],["pack up","をかばんに詰める"],["tuck in","を心地よくくるむ"],["wash down","を洗い流す、を飲み下す、流し込む"],["go under","倒産する、沈む"],["turn over","を熟考する、をひっくり返す"],["tip over","倒れる、ひっくり返る、をひっくり返す"],["press for","を強く求める、迫る"],["stand over","を監視する"],["touch up","を手直しして改良する"],["get in on","～に加わる、に参入する"],["put through","をつなぐ"],["shut out","を遮る、を締め出す"],["face off","対決する"],["pick through","を探す"],["drive off","を追い払う"],["pass for","～で通用する、～として通る"],["hold over","を持ち越す、先送りにする"],["run down","をはねる、をけなす、止まる"],["slip by","いつの間にか過ぎる"],["put up with","を耐える、我慢する"],["pin down","を突き止める、を組み伏せる"],["rub in","を繰り返し言う、をすり込む"],["clear out","をきれいにする"],["doze off","うたた寝する"],["take up","を始める、を取り上げる、を占める"],["drive out","を追い出す、駆逐する"],["set up","を設立する、を設定する、をわなにはめる"],["act up","再発する、不調である、いたずらをする"],["run out","尽きる、なくなる"],["single out","を選び出す"],["break up","終わる、別れる、を解散させる、をばらばらにする"],["deal in","を扱う、商う"],["break out","急に始まる、勃発する"],["water down","～の内容を薄める、～に手心を加える"],["pass on","を渡す、伝える、（病気など）をうつす"],["fall apart","ばらばらになる、崩壊する"],["settle in","落ち着く、慣れる"],["step out","（建物などを）出る、（乗物から）降りる"],["mark down","を値下げする、を書き留める"],["break in on","～に口をはさむ、割り込む"],["sit in on","を傍聴する"],["buy up","を買い占める"],["size up","を判断する、見極める"],["let off","を罰さない、釈放する、を発砲する"],["mark out","を区切る、を目立たせる"],["feed off","を食料にする、糧にする"],["flag down","を手を挙げて止める"],["rise above","を克服する、を気に留めない"],["figure on","を想定する、見込む"],["hold up","続く、持ちこたえる"],["tell off","を叱る、～にどなる"],["live down","を忘れる"],["feel out","を探る、知ろうとする"],["hammer out","を考え出す"],["throw off","を脱ぎ捨てる、を振り捨てる"],["pass over","外す"],["pull up","車を止める、を引く、寄せる"],["pass down","を伝える"],["come by","を手に入れる、～に立ち寄る"],["take to","～が好きになる、～するようになる"],["head off to","を阻止する、進む、向かう"],["cough up","をしぶしぶ出す"],["stop over","立ち寄る、一時滞在する"],["drive up","を押し上げる、つり上げる"],["follow up","追跡調査する、～のあとに行う"],["level off","成長が止まる、水平飛行に移る"],["deal out","を分配する"],["stick by","支援し続ける、を実行する"],["show up","現れる、来る"],["write back","返事を書く"],["stack up","渋滞する、増え続ける、匹敵する"],["tuck away","をしまい込む、（受身で）隠れている"],["crack up","を大笑いさせる、大笑いする、大破する"],["rip off","をはぎ取る、(人)からぼったくる"],["scratch out","を線を引いて消す、抹消する"],["whip up","をかき立てる、を舞い上げる"],["rack up","を得る、積み重ねる"],["shove off","離れる、出ていく、船を押し出す"],["bottom out","底をつく"],["nod off","うとうとする、居眠りする"],["send for","を注文する、(人)を呼びに行かせる"],["stay off","を食べない、飲まない、を避ける"],["act out","を演じてみせる"],["fix up","を修理する、(人)に(～を)提供する"],["carry through","実行する、を上手くやり遂げる"],["roll in","大量にやって来る、遅れて到着する、広がり始める"],["answer for","～の責任を取る、を保証する"],["stand up to","～に恐れずに立ち向かえる、～に耐える、もつ"],["free up","を空ける、を解放する"],["weigh on","～にのしかかる、を圧迫する"],["tie up","をしっかりくくる、を縛り上げる、（受身で）忙しい"],["grow on","～の心を引くようになる"],["let out","を外に出す、を発する、終わる"],["lock A in B","AをBに閉じ込める"],["watch over","を見守る"],["blast off","発信する"],["go back on","を破る"],["lay into","を非難する、殴打する"],["force down","を無理やり飲み込む、を緊急着陸させる"],["bring off","をうまく成し遂げる"],["pile up","積もる、たまる"],["ease into","～に徐々に慣れる"],["break off","急に話をやめる、取れる"],["hang onto","～次第である"],["fall under","～の分類に入る"],["send out for","～の出前を頼む"],["fire up","（受身で）気合が入っている、張り切っている"],["check off","～にチェック済みの印をつける"],["gear up","準備をする"],["derive from","～に由来する、～から派生する"],["dream up","を思いつく"],["carry over","持ち越される、残存する、～を持ち越す"],["get on with","を続ける、をうまくこなす"],["turn to","を頼る、を始める"],["make do with","～で間に合わせる"],["kick in","効果が出始める"],["pitch in","協力する、援助する"]];

let stats = loadStats();
let currentQuestion = {};
let isSorted = false;
let lowAccuracyMode = false;

function shuffle(array) {
    return array.sort(() => Math.random() - 0.5);
}

function getChoices(correctAnswer) {
    let choices = shuffle(data.map(item => item[1])).filter(choice => choice !== correctAnswer).slice(0, 3);
    choices.push(correctAnswer);
    return shuffle(choices);
}

function loadStats() {
    let savedStats = localStorage.getItem("quizStats");
    return savedStats ? JSON.parse(savedStats) : {};
}

function saveStats(stats) {
    localStorage.setItem("quizStats", JSON.stringify(stats));
}

function getRandomQuestion() {
    let filteredData = lowAccuracyMode ? data.filter(([english]) => {
        let stat = stats[english] || { correct: 0, total: 0 };
        return stat.total === 0 || (stat.correct / stat.total) < 0.5;
    }) : data;
    
    if (filteredData.length === 0) filteredData = data;
    return filteredData[Math.floor(Math.random() * filteredData.length)];
}

function loadQuestion() {
    let [english, japanese] = getRandomQuestion();
    let choices = getChoices(japanese);
    
    currentQuestion = { question: english, answer: japanese };
    
    document.getElementById("question").textContent = `「${english}」の意味は？`;
    let optionsContainer = document.getElementById("options");
    optionsContainer.innerHTML = "";
    
    choices.forEach(choice => {
        let button = document.createElement("button");
        button.textContent = choice;
        button.onclick = () => checkAnswer(choice);
        optionsContainer.appendChild(button);
    });
}

function checkAnswer(selected) {
    let feedback = document.getElementById("feedback");
    let english = currentQuestion.question;
    
    if (!stats[english]) {
        stats[english] = { correct: 0, total: 0 };
    }
    stats[english].total++;
    
    if (selected === currentQuestion.answer) {
        feedback.textContent = "正解！";
        feedback.style.color = "green";
        stats[english].correct++;
    } else {
        feedback.textContent = `不正解！正解は「${currentQuestion.answer}」です。`;
        feedback.style.color = "red";
    }
    saveStats(stats);
    document.getElementById("next").style.display = "block";
}

function nextQuestion() {
    document.getElementById("feedback").textContent = "";
    document.getElementById("next").style.display = "none";
    loadQuestion();
}

function toggleLowAccuracyMode() {
    lowAccuracyMode = !lowAccuracyMode;
    document.getElementById("low-accuracy-mode").textContent = lowAccuracyMode ? "低正答率モード" : "通常モード";
    loadQuestion();
}

window.onload = loadQuestion;
